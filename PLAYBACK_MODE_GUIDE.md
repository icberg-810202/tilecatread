# 语录播放模式功能说明

## 功能概述
为语录应用新增了强大的播放模式功能，让您可以更精确地控制在启动页显示哪些语录。

## 主要功能

### 1. 语录序号与选择
- **序号显示**：每条语录前都有一个蓝色圆形序号，方便快速定位
- **复选框**：每条语录左侧有一个复选框，可以勾选需要播放的语录
- **选中状态**：被选中的语录会高亮显示（绿色边框和浅绿背景）

### 2. 三种播放模式

#### 🎯 顺序播放模式
- **适用场景**：适合按顺序学习、阅读语录
- **工作方式**：每次启动应用时，按选中语录的顺序依次显示
- **使用建议**：适合有序的语录集合，如学习笔记、渐进式内容

#### 🎲 随机播放模式（默认）
- **适用场景**：希望每次看到不同的内容，保持新鲜感
- **工作方式**：每次启动时从选中的语录中随机抽取一条显示
- **使用建议**：适合灵感语录、名言警句等

#### 🔂 单条重复模式
- **适用场景**：专注于某一条语录，反复记忆或思考
- **工作方式**：每次启动都显示同一条选中的语录
- **限制**：此模式只能选择1条语录
- **使用建议**：适合重要提醒、座右铭等

### 3. 播放控制面板
位于语录管理页面顶部，包含：
- **模式选择**：三个单选按钮，选择不同的播放模式
- **提示信息**：实时显示当前模式和选中语录数量
- **选择摘要**：显示本书已选语录数和全部已选语录数

## 使用方法

### 步骤1：选择语录
1. 进入"我的书库"
2. 点击某本书进入语录管理页面
3. 勾选想要在启动页显示的语录
4. 可以从不同的书籍中选择多条语录

### 步骤2：设置播放模式
在语录管理页面顶部的播放控制面板中：
1. 选择您需要的播放模式（顺序/随机/单条重复）
2. 查看提示信息确认设置正确
3. 设置会自动保存

### 步骤3：查看效果
1. 退出登录或关闭应用
2. 重新打开应用
3. 启动页将根据您的设置显示相应的语录

## 技术特性

### 数据持久化
- 所有播放设置自动保存到本地存储
- 选中的语录信息保存在 `localStorage` 中
- 即使关闭浏览器，设置也会保留

### 多用户支持
- 每个用户都有独立的播放设置
- 不同用户的设置互不干扰
- 切换用户时自动加载对应的设置

### 顺序播放的记忆功能
- 顺序播放会记住上次播放到哪一条
- 下次启动时从下一条继续
- 播放完所有语录后自动从头开始

## 界面说明

### 语录卡片元素
```
┌─────────────────────────────────────┐
│ ☑  ①  "语录内容..."         [编辑] [删除] │
│        页码: 42                           │
│        #标签1 #标签2                      │
└─────────────────────────────────────┘
```
- `☑`：复选框，勾选后加入播放列表
- `①`：序号，蓝色圆形，选中后变为绿色
- 右侧按钮：编辑和删除功能

### 播放控制面板
```
┌─────────────────────────────────────┐
│ 🎵 语录播放设置                        │
│ 选择播放模式，启动页将按模式显示语录    │
├─────────────────────────────────────┤
│ ⃝ ▶️ 顺序播放 - 按顺序显示选中的语录   │
│ ⃝ 🔀 随机播放 - 随机显示选中的语录     │
│ ⃝ 🔂 单条重复 - 重复显示选中的一条语录 │
├─────────────────────────────────────┤
│ 当前模式：随机播放 | 本书已选：3/10条  │
│ 全部已选：15条                         │
└─────────────────────────────────────┘
```

## 注意事项

1. **单条重复模式限制**
   - 只能选择1条语录
   - 如果选中多条，会有提示信息

2. **无选中语录时**
   - 如果没有选中任何语录，将使用原有逻辑
   - 从选中的书籍中随机显示语录
   - 如果没有选中的书籍，显示所有书籍的语录

3. **书籍选择优先级**
   - 语录级别的选择优先于书籍级别
   - 如果有选中的语录，将优先显示这些语录
   - 没有选中语录时，才会使用书籍选择功能

## 文件说明

### 新增文件
- `playback-controller.js`：播放模式控制器，包含所有播放模式相关的功能

### 修改文件
- `index.html`：添加了播放控制面板UI
- `style.css`：添加了播放控制面板和语录选择的样式
- `script-supabase.js`：
  - 修改了 `renderQuotesList()` 函数，添加序号和复选框
  - 修改了 `showRandomQuote()` 函数，支持播放模式

## 开发者说明

### 核心函数

#### 播放设置管理
```javascript
loadPlaybackSettings(username)  // 加载用户的播放设置
savePlaybackSettings(username, settings)  // 保存播放设置
```

#### 播放模式控制
```javascript
changePlaybackMode(mode)  // 切换播放模式
updatePlaybackHint(mode, count)  // 更新提示信息
```

#### 语录选择
```javascript
toggleQuoteSelection(bookIndex, quoteIndex)  // 切换语录选中状态
isQuoteSelected(bookIndex, quoteIndex)  // 检查语录是否被选中
```

### 数据结构

播放设置对象：
```javascript
{
    mode: 'random',  // 'sequential' | 'random' | 'single'
    selectedQuotes: [  // 选中的语录列表
        { bookIndex: 0, quoteIndex: 1 },
        { bookIndex: 1, quoteIndex: 3 }
    ],
    currentIndex: 0  // 顺序播放时的当前索引
}
```

### localStorage键名
- `playbackSettings_<username>`：存储用户的播放设置

## 版本信息

- **版本**：1.1.0
- **更新日期**：2025-10-24
- **新增功能**：语录序号、选择框、三种播放模式

## 后续计划

可能的功能扩展：
- [ ] 批量选择/取消选择
- [ ] 播放历史记录
- [ ] 语录标签过滤播放
- [ ] 定时自动切换模式
- [ ] 语录播放统计
