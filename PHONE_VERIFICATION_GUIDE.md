# 📱 手机号登录与密码重置功能说明

## 🎉 更新内容

本次更新将用户认证系统升级为**手机号登录**，并新增**忘记密码**功能。

---

## ✨ 新功能列表

### 1. **手机号注册/登录**
- ✅ 用户名改为手机号（11位中国大陆手机号）
- ✅ 手机号格式自动验证
- ✅ 密码强度实时检测（必须包含字母+数字，≥8位）

### 2. **忘记密码功能**
- ✅ 通过手机号验证码重置密码
- ✅ 验证码有效期5分钟
- ✅ 60秒发送间隔限制
- ✅ 新密码强度实时检测

### 3. **验证码系统（模拟）**
- ✅ 6位随机数字验证码
- ✅ 验证码过期检测
- ✅ 测试模式下直接显示验证码

---

## 🚀 使用流程

### 注册新用户
1. 点击"注册新用户"
2. 输入11位手机号（如：13800138000）
3. 设置密码（必须包含字母+数字，≥8位）
4. 确认密码
5. 点击"注册"

### 登录
1. 输入手机号
2. 输入密码
3. 点击"登录"

### 忘记密码
1. 在登录页点击"忘记密码？"
2. 输入已注册的手机号
3. 点击"发送验证码"（**测试模式下会弹窗显示验证码**）
4. 输入收到的6位验证码
5. 设置新密码（必须包含字母+数字，≥8位）
6. 确认新密码
7. 点击"重置密码"

---

## 🔐 密码要求

- **最短长度**: 8位
- **必须包含**: 字母（a-z, A-Z）
- **必须包含**: 数字（0-9）
- **推荐**: 大小写混合 + 特殊字符

### 密码强度等级

| 强度 | 条件 |
|------|------|
| 🔴 弱 | 不符合基本要求 |
| 🟡 中 | 8位+字母+数字 |
| 🟢 强 | 12位+大小写混合+特殊字符 |

---

## 📱 手机号格式要求

- **长度**: 11位
- **首位**: 1
- **第二位**: 3-9
- **示例**: 13800138000, 15912345678

---

## 🧪 测试模式说明

### 当前实现
在测试模式下，发送验证码后会直接在弹窗中显示验证码，方便测试。

```javascript
alert(`验证码已发送！\n\n【测试模式】验证码：${code}\n有效期5分钟`);
```

### 生产环境集成

实际部署时，需要集成真实短信服务：

#### 推荐短信服务商

1. **阿里云短信服务**
   - 网站: https://www.aliyun.com/product/sms
   - 特点: 国内稳定，价格实惠

2. **腾讯云短信**
   - 网站: https://cloud.tencent.com/product/sms
   - 特点: 接入简单，技术支持好

3. **Twilio（国际）**
   - 网站: https://www.twilio.com/sms
   - 特点: 全球覆盖，功能强大

#### 集成示例（阿里云）

```javascript
async function sendSMS(phone, code) {
    const response = await fetch('YOUR_BACKEND_API/send-sms', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            phone: phone,
            code: code
        })
    });
    
    const result = await response.json();
    if (!result.success) {
        throw new Error('短信发送失败');
    }
    
    return result;
}
```

**⚠️ 安全提示**: 短信API调用应该在**后端服务器**进行，避免暴露API密钥！

---

## 🗄️ 数据存储

### 本地模式
- 手机号和密码存储在 `localStorage`
- 验证码临时存储在内存变量 `verificationCodes`

### Supabase 云端模式
- 用户数据存储在 `users` 表
- 字段 `username` 存储手机号
- 密码经过哈希后存储在 `password_hash`

---

## 🔒 安全考虑

### 当前实现
- ✅ 密码简单哈希
- ✅ 验证码5分钟过期
- ✅ 60秒发送间隔限制
- ✅ 手机号格式验证

### 生产环境建议
- 🔐 使用 bcrypt 或 Argon2 加密密码
- 🔐 启用 HTTPS
- 🔐 添加短信发送频率限制（防刷）
- 🔐 添加账号锁定机制（多次错误登录）
- 🔐 使用 Supabase Auth 替代自定义认证

---

## 📂 修改文件列表

### HTML
- ✅ `index.html`
  - 登录页：手机号输入框 + 忘记密码链接
  - 注册页：手机号输入框
  - 新增：忘记密码页面

### CSS
- ✅ `style.css`
  - 忘记密码链接样式
  - 验证码输入组样式
  - 发送验证码按钮样式

### JavaScript
- ✅ `script-supabase.js`
  - `validatePhone()`: 手机号验证
  - `generateVerifyCode()`: 生成验证码
  - `sendSMS()`: 发送短信（模拟）
  - `sendVerifyCode()`: 发送验证码逻辑
  - `resetPassword()`: 重置密码逻辑
  - `displayResetPasswordStrength()`: 密码强度显示
  - 更新 `register()` 和 `login()` 支持手机号

---

## 🎯 测试清单

### 注册测试
- [ ] 输入非法手机号（如：12345）→ 应提示错误
- [ ] 密码不含字母 → 应提示错误
- [ ] 密码少于8位 → 应提示错误
- [ ] 两次密码不一致 → 应提示错误
- [ ] 正常注册 → 成功跳转到登录页

### 登录测试
- [ ] 输入非法手机号 → 应提示错误
- [ ] 错误密码 → 应提示错误
- [ ] 正确手机号和密码 → 成功进入主页

### 忘记密码测试
- [ ] 未注册手机号 → 应提示"该手机号未注册"
- [ ] 点击"发送验证码" → 应显示验证码
- [ ] 60秒内再次点击 → 按钮禁用，显示倒计时
- [ ] 输入错误验证码 → 应提示错误
- [ ] 验证码过期（5分钟后） → 应提示过期
- [ ] 新密码不符合要求 → 应提示错误
- [ ] 正确流程 → 成功重置密码，跳转登录页

---

## 💡 使用建议

### 开发/测试阶段
使用当前的**模拟短信模式**，验证码直接显示在弹窗中，方便测试。

### 生产环境部署
1. 集成真实短信服务（阿里云/腾讯云）
2. 将短信发送逻辑移至后端服务器
3. 配置环境变量存储API密钥
4. 添加发送频率限制和成本监控

---

## 🆘 常见问题

### Q: 忘记密码时验证码在哪里查看？
**A**: 当前是测试模式，点击"发送验证码"后会弹窗显示。生产环境需要查收手机短信。

### Q: 如何更改手机号？
**A**: 当前版本不支持更改手机号。未来可以添加"账号设置"功能。

### Q: 可以用邮箱注册吗？
**A**: 当前仅支持手机号。如需支持邮箱，需要修改验证逻辑。

### Q: 密码强度如何判断？
**A**: 
- 基本要求：≥8位，包含字母+数字
- 中等强度：满足基本要求
- 高强度：≥12位 + 大小写混合 + 特殊字符

---

## 📞 技术支持

如有问题，请检查：
1. 浏览器控制台（F12）是否有错误信息
2. 手机号格式是否正确（11位，首位为1）
3. 密码是否符合强度要求

---

**祝使用愉快！** 📱✨
