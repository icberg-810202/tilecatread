<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bwhisper</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- LeanCloud SDK - ä½¿ç”¨å¤šä¸ªCDNåå¤‡æ–¹æ¡ˆ -->
    <script>
        // åŠ¨æ€åŠ è½½LeanCloud SDKï¼Œå¸¦æœ‰å¤±è´¥é‡è¯•
        (function() {
            const cdnUrls = [
                'https://unpkg.com/leancloud-storage@4.13.0/dist/av-min.js',
                'https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.0/dist/av-min.js',
                'https://cdn.bootcdn.net/ajax/libs/leancloud-storage/4.13.0/av-min.js'
            ];
            
            let currentIndex = 0;
            
            function loadSDK() {
                if (currentIndex >= cdnUrls.length) {
                    console.error('âŒ æ‰€æœ‰CDNå‡åŠ è½½å¤±è´¥ï¼ŒLeanCloudå°†ä¸å¯ç”¨');
                    return;
                }
                
                const script = document.createElement('script');
                script.src = cdnUrls[currentIndex];
                
                script.onload = function() {
                    console.log('âœ… LeanCloud SDKåŠ è½½æˆåŠŸï¼Œæ¥æº:', cdnUrls[currentIndex]);
                };
                
                script.onerror = function() {
                    console.warn('âš ï¸ CDNåŠ è½½å¤±è´¥:', cdnUrls[currentIndex]);
                    currentIndex++;
                    loadSDK(); // å°è¯•ä¸‹ä¸€ä¸ªCDN
                };
                
                document.head.appendChild(script);
            }
            
            loadSDK();
        })();
    </script>
    
    <style>
        /* å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨æ ·å¼ */
        .password-strength {
            height: 5px;
            margin: 5px 0 10px 0;
            border-radius: 3px;
            background: #eee;
            display: none;
        }
        .strength-weak {
            width: 33%;
            height: 100%;
            background: #ff4d4f;
        }
        .strength-medium {
            width: 66%;
            height: 100%;
            background: #faad14;
        }
        .strength-strong {
            width: 100%;
            height: 100%;
            background: #52c41a;
        }
        .strength-text {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- å¯åŠ¨é¡µ -->
    <div id="splashPage" class="page">
        <div class="quote-card">
            <div class="quote-content" id="splashQuoteContent">
                <!-- è¯­å½•å†…å®¹ -->
            </div>
            <div class="quote-source" id="splashQuoteSource">
                <!-- ä¹¦ç±ä¿¡æ¯ -->
            </div>
            <div class="countdown">
                <span id="countdown">10</span>ç§’åè¿›å…¥ç™»å½•é¡µ
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·ç™»å½•é¡µ -->
    <div id="loginPage" class="page hidden">
        <div class="auth-container">
            <div class="auth-logo">
                <h1>ğŸ“š Bwhisper</h1>
            </div>
            <div class="auth-subtitle">æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•æ‚¨çš„è´¦æˆ·</div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="tel" id="username" placeholder="æ‰‹æœºå·" maxlength="11" class="modern-input">
                </div>
                <div class="input-wrapper">
                    <input type="password" id="password" placeholder="å¯†ç " class="modern-input">
                </div>
                <div class="forgot-password-modern">
                    <a href="javascript:void(0)" onclick="showForgotPassword()">å¿˜è®°å¯†ç ï¼Ÿ</a>
                </div>
                <button onclick="login()" class="btn-modern-primary">ç™»å½•</button>
                <div class="auth-divider">
                    <span>æˆ–</span>
                </div>
                <button onclick="showRegister()" class="btn-modern-secondary">æ³¨å†Œæ–°è´¦æˆ·</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·æ³¨å†Œé¡µ -->
    <div id="registerPage" class="page hidden">
        <div class="auth-container">
            <div class="auth-header">
                <button onclick="backToLogin()" class="back-icon">â†</button>
                <h2>æ³¨å†Œè´¦æˆ·</h2>
            </div>
            <div class="auth-subtitle">åˆ›å»ºæ‚¨çš„é˜…è¯»ç¬”è®°è´¦æˆ·</div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="tel" id="regUsername" placeholder="æ‰‹æœºå·" maxlength="11" class="modern-input">
                </div>
                <div class="input-wrapper">
                    <input type="password" id="regPassword" placeholder="å¯†ç ï¼ˆè‡³å°‘6ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰" class="modern-input">
                </div>
                <div class="password-strength-modern" id="regPasswordStrength">
                    <div class="strength-bar-container">
                        <div id="strengthBar" class="strength-bar"></div>
                    </div>
                    <div class="strength-text" id="strengthText"></div>
                </div>
                <div class="input-wrapper">
                    <input type="password" id="regConfirmPassword" placeholder="ç¡®è®¤å¯†ç " class="modern-input">
                </div>
                <button onclick="register()" class="btn-modern-primary">æ³¨å†Œ</button>
            </div>
        </div>
    </div>

    <!-- å¿˜è®°å¯†ç  - ç¬¬ä¸€æ­¥ï¼šéªŒè¯æ‰‹æœºå· -->
    <div id="forgotPasswordStep1" class="page hidden">
        <div class="auth-container">
            <div class="auth-header">
                <button onclick="backToLogin()" class="back-icon">â†</button>
                <h2>é‡ç½®å¯†ç </h2>
            </div>
            <div class="auth-subtitle">è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·ï¼Œæˆ‘ä»¬å°†å‘é€éªŒè¯ç </div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="tel" id="resetPhone" placeholder="æ‰‹æœºå·" maxlength="11" class="modern-input">
                </div>
                <div class="verify-code-wrapper">
                    <input type="text" id="verifyCode" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6" class="modern-input">
                    <button onclick="sendVerifyCode()" id="sendCodeBtn" class="code-btn">è·å–éªŒè¯ç </button>
                </div>
                <button onclick="verifyCodeAndNext()" class="btn-modern-primary">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>
    </div>

    <!-- å¿˜è®°å¯†ç  - ç¬¬äºŒæ­¥ï¼šè®¾ç½®æ–°å¯†ç  -->
    <div id="forgotPasswordStep2" class="page hidden">
        <div class="auth-container">
            <div class="auth-header">
                <button onclick="backToStep1()" class="back-icon">â†</button>
                <h2>è®¾ç½®æ–°å¯†ç </h2>
            </div>
            <div class="auth-subtitle">è¯·è®¾ç½®æ‚¨çš„æ–°å¯†ç </div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="password" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰" class="modern-input">
                </div>
                <div class="password-strength-modern" id="resetPasswordStrength">
                    <div class="strength-bar-container">
                        <div id="resetStrengthBar" class="strength-bar"></div>
                    </div>
                    <div class="strength-text" id="resetStrengthText"></div>
                </div>
                <div class="input-wrapper">
                    <input type="password" id="confirmNewPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " class="modern-input">
                </div>
                <button onclick="resetPassword()" class="btn-modern-primary">å®Œæˆé‡ç½®</button>
            </div>
        </div>
    </div>

    <!-- æˆ‘çš„ä¹¦åº“ä¸»é¡µ -->
    <div id="mainPage" class="page hidden">
        <header class="header">
            <div class="user-info">
                <span id="currentUser">ç”¨æˆ·</span>
                <button onclick="exportData()" class="btn-backup">ğŸ’¾ å¤‡ä»½æ•°æ®</button>
                <button onclick="importData()" class="btn-restore">ğŸ“¥ æ¢å¤æ•°æ®</button>
                <button onclick="logout()" class="logout-btn">é€€å‡º</button>
                <input type="file" id="importFile" accept=".json" style="display: none;">
            </div>
            <h1>ğŸ“š æˆ‘çš„ä¹¦åº“</h1>
            <div class="selection-info" id="selectionInfo">
                <!-- é€‰æ‹©ä¿¡æ¯æç¤º -->
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="æœç´¢ä¹¦åæˆ–ä½œè€…...">
                <button onclick="performSearch()">æœç´¢</button>
                <button onclick="backToLibrary()" class="btn-secondary">è¿”å›ä¹¦åº“</button>
            </div>
        </header>

        <main class="book-shelf">
            <div class="books-grid" id="booksGrid">
                <!-- ä¹¦ç±å¡ç‰‡ -->
            </div>
            
            <div class="add-book-card" onclick="showAddBookModal()">
                <div class="add-book-icon">+</div>
                <p>æ·»åŠ æ–°ä¹¦</p>
            </div>
        </main>
    </div>

    <!-- è¯­å½•ç®¡ç†é¡µ -->
    <div id="quotesPage" class="page hidden">
        <header class="header">
            <button onclick="backToMain()" class="back-btn">â† è¿”å›</button>
            <h2 id="currentBookTitle">ä¹¦ç±è¯­å½•ç®¡ç†</h2>
        </header>
        
        <div class="quotes-management">
            <!-- æ’­æ”¾æ¨¡å¼æ§åˆ¶é¢æ¿ -->
            <div class="playback-control-panel">
                <div class="playback-header">
                    <span class="playback-title">ğŸµ è¯­å½•æ’­æ”¾è®¾ç½®</span>
                    <span class="playback-hint" id="playbackHint">é€‰æ‹©æ’­æ”¾æ¨¡å¼ï¼Œå¯åŠ¨é¡µå°†æŒ‰æ¨¡å¼æ˜¾ç¤ºè¯­å½•</span>
                </div>
                <div class="playback-modes">
                    <label class="playback-mode-option">
                        <input type="radio" name="playbackMode" value="sequential" onclick="changePlaybackMode('sequential')">
                        <span class="mode-icon">â–¶ï¸</span>
                        <span class="mode-label">é¡ºåºæ’­æ”¾</span>
                        <span class="mode-desc">æŒ‰é¡ºåºæ˜¾ç¤ºé€‰ä¸­çš„è¯­å½•</span>
                    </label>
                    <label class="playback-mode-option">
                        <input type="radio" name="playbackMode" value="random" onclick="changePlaybackMode('random')">
                        <span class="mode-icon">ğŸ”€</span>
                        <span class="mode-label">éšæœºæ’­æ”¾</span>
                        <span class="mode-desc">éšæœºæ˜¾ç¤ºé€‰ä¸­çš„è¯­å½•</span>
                    </label>
                    <label class="playback-mode-option">
                        <input type="radio" name="playbackMode" value="single" onclick="changePlaybackMode('single')">
                        <span class="mode-icon">ğŸ”‚</span>
                        <span class="mode-label">å•æ¡é‡å¤</span>
                        <span class="mode-desc">é‡å¤æ˜¾ç¤ºé€‰ä¸­çš„ä¸€æ¡è¯­å½•</span>
                    </label>
                </div>
                <div class="selection-summary" id="selectionSummary">
                    <!-- é€‰æ‹©ç»Ÿè®¡ä¿¡æ¯ -->
                </div>
            </div>
            
            <div class="quotes-list" id="quotesList">
                <!-- è¯­å½•åˆ—è¡¨ -->
            </div>
            <button onclick="showAddQuoteModal()" class="add-quote-btn">+ æ·»åŠ è¯­å½•</button>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <!-- æ·»åŠ æ–°ä¹¦æ¨¡æ€æ¡† -->
    <div id="addBookModal" class="modal hidden">
        <div class="modal-content">
            <h3>æ·»åŠ æ–°ä¹¦</h3>
            <input type="text" id="newBookName" placeholder="ä¹¦ç±åç§°">
            <input type="text" id="newBookAuthor" placeholder="ä½œè€…">
            <div class="modal-actions">
                <button onclick="addNewBook()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeAddBookModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <div id="editBookModal" class="modal hidden">
        <div class="modal-content">
            <h3>ç¼–è¾‘ä¹¦ç±ä¿¡æ¯</h3>
            <input type="hidden" id="editBookIndex">
            <input type="text" id="editBookName" placeholder="ä¹¦ç±åç§°">
            <input type="text" id="editBookAuthor" placeholder="ä½œè€…">
            <div class="modal-actions">
                <button onclick="saveBookEdit()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeEditBookModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div id="addQuoteModal" class="modal hidden">
        <div class="modal-content">
            <h3>æ·»åŠ è¯­å½•</h3>
            <textarea id="newQuoteText" placeholder="è¾“å…¥è¯­å½•å†…å®¹..."></textarea>
            <div class="quote-metadata">
                <input type="text" id="newQuotePage" placeholder="é¡µç ï¼ˆå¯é€‰ï¼‰">
                <input type="text" id="newQuoteTag" placeholder="æ ‡ç­¾ï¼ˆå¯é€‰ï¼Œç”¨é€—å·åˆ†éš”ï¼‰">
            </div>
            <div class="modal-actions">
                <button onclick="addNewQuote()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeAddQuoteModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div id="editQuoteModal" class="modal hidden">
        <div class="modal-content">
            <h3>ç¼–è¾‘è¯­å½•</h3>
            <input type="hidden" id="editQuoteIndex">
            <textarea id="editQuoteText" placeholder="è¾“å…¥è¯­å½•å†…å®¹..."></textarea>
            <div class="quote-metadata">
                <input type="text" id="editQuotePage" placeholder="é¡µç ï¼ˆå¯é€‰ï¼‰">
                <input type="text" id="editQuoteTag" placeholder="æ ‡ç­¾ï¼ˆå¯é€‰ï¼Œç”¨é€—å·åˆ†éš”ï¼‰">
            </div>
            <div class="modal-actions">
                <button onclick="saveQuoteEdit()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeEditQuoteModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- JSONbin é…ç½®æ–‡ä»¶ -->
    <script defer src="jsonbin-config.js"></script>
    
    <!-- æ•°æ®ç®¡ç†å±‚ -->
    <script defer src="dataManager.js"></script>
    
    <!-- åº”ç”¨é€»è¾‘å±‚ -->
    <script defer src="script-jsonbin.js"></script>
    
    <!-- æ’­æ”¾æ§åˆ¶å™¨ -->
    <script defer src="playback-controller.js"></script>
    
    <!-- è„šæœ¬åŠ è½½å®Œæˆåçš„éªŒè¯ -->
    <script>
        // ç¡®ä¿æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆ
        window.addEventListener('DOMContentLoaded', function() {
            console.log('=== DOMåŠ è½½å®Œæˆï¼ŒéªŒè¯å‡½æ•°å®šä¹‰ ===');
            
            // éªŒè¯å…³é”®å‡½æ•°
            const criticalFunctions = ['showRegister', 'showPage', 'login', 'register', 'backToLogin'];
            let allDefined = true;
            
            criticalFunctions.forEach(func => {
                const isDefined = typeof window[func] === 'function';
                console.log(`${isDefined ? 'âœ…' : 'âŒ'} ${func}: ${isDefined ? 'å·²å®šä¹‰' : 'æœªå®šä¹‰'}`);
                if (!isDefined) allDefined = false;
            });
            
            if (allDefined) {
                console.log('âœ… æ‰€æœ‰å…³é”®å‡½æ•°éƒ½å·²å®šä¹‰ï¼');
            } else {
                console.error('âŒ æŸäº›å‡½æ•°æœªå®šä¹‰ï¼Œå¯èƒ½å­˜åœ¨è„šæœ¬åŠ è½½é—®é¢˜ï¼');
            }
        });
    </script>
</body>
</html>