<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bwhisper</title>
    <!-- ç¦ç”¨faviconè¯·æ±‚ -->
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="style.css">
    
    <!-- LeanCloud SDK - CDNç‰ˆæœ¬ -->
    <script src="https://unpkg.com/leancloud-storage@4.13.0/dist/av-min.js"></script>
    
    <style>
        /* å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨æ ·å¼ */
        .password-strength {
            height: 5px;
            margin: 5px 0 10px 0;
            border-radius: 3px;
            background: #eee;
            display: none;
        }
        .strength-weak {
            width: 33%;
            height: 100%;
            background: #ff4d4f;
        }
        .strength-medium {
            width: 66%;
            height: 100%;
            background: #faad14;
        }
        .strength-strong {
            width: 100%;
            height: 100%;
            background: #52c41a;
        }
        .strength-text {
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }
        /* è°ƒè¯•é“¾æ¥æ ·å¼ */
        .debug-links {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
        }
        .debug-links a {
            display: inline-block;
            margin-left: 10px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            text-decoration: none;
            border-radius: 4px;
            font-size: 12px;
        }
        .debug-links a:hover {
            background: rgba(0,0,0,0.9);
        }
    </style>
</head>
<body>
    <!-- è°ƒè¯•é“¾æ¥å·²åˆ é™¤ -->
    <!-- å¯åŠ¨é¡µ -->
    <div id="splashPage" class="page">
        <div class="quote-card">
            <div class="quote-content" id="splashQuoteContent">
                <!-- è¯­å½•å†…å®¹ -->
            </div>
            <div class="quote-source" id="splashQuoteSource">
                <!-- ä¹¦ç±ä¿¡æ¯ -->
            </div>
            <div class="countdown">
                <span id="countdown">10</span>ç§’åè¿›å…¥ç™»å½•é¡µ
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·ç™»å½•é¡µ -->
    <div id="loginPage" class="page hidden">
        <div class="auth-container">
            <div class="auth-logo">
                <h1>ğŸ“š Bwhisper</h1>
            </div>
            <div class="auth-subtitle">æ¬¢è¿å›æ¥ï¼Œè¯·ç™»å½•æ‚¨çš„è´¦æˆ·</div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="tel" id="username" placeholder="æ‰‹æœºå·" maxlength="11" class="modern-input">
                </div>
                <div class="input-wrapper">
                    <input type="password" id="password" placeholder="å¯†ç " class="modern-input">
                </div>
                <div class="forgot-password-modern">
                    <a href="javascript:void(0)" onclick="showForgotPassword()">å¿˜è®°å¯†ç ï¼Ÿ</a>
                </div>
                <button onclick="login()" class="btn-modern-primary">ç™»å½•</button>
                <div class="auth-divider">
                    <span>æˆ–</span>
                </div>
                <button onclick="showRegister()" class="btn-modern-secondary">æ³¨å†Œæ–°è´¦æˆ·</button>
            </div>
        </div>
    </div>

    <!-- ç”¨æˆ·æ³¨å†Œé¡µ -->
    <div id="registerPage" class="page hidden">
        <div class="auth-container">
            <div class="auth-header">
                <button onclick="backToLogin()" class="back-icon">â†</button>
                <h2>æ³¨å†Œè´¦æˆ·</h2>
            </div>
            <div class="auth-subtitle">åˆ›å»ºæ‚¨çš„é˜…è¯»ç¬”è®°è´¦æˆ·</div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="tel" id="regUsername" placeholder="æ‰‹æœºå·" maxlength="11" class="modern-input">
                </div>
                <div class="input-wrapper">
                    <input type="password" id="regPassword" placeholder="å¯†ç ï¼ˆè‡³å°‘6ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰" class="modern-input">
                </div>
                <div class="password-strength-modern" id="regPasswordStrength">
                    <div class="strength-bar-container">
                        <div id="strengthBar" class="strength-bar"></div>
                    </div>
                    <div class="strength-text" id="strengthText"></div>
                </div>
                <div class="input-wrapper">
                    <input type="password" id="regConfirmPassword" placeholder="ç¡®è®¤å¯†ç " class="modern-input">
                </div>
                <button onclick="register()" class="btn-modern-primary">æ³¨å†Œ</button>
            </div>
        </div>
    </div>

    <!-- å¿˜è®°å¯†ç  - ç¬¬ä¸€æ­¥ï¼šéªŒè¯æ‰‹æœºå· -->
    <div id="forgotPasswordStep1" class="page hidden">
        <div class="auth-container">
            <div class="auth-header">
                <button onclick="backToLogin()" class="back-icon">â†</button>
                <h2>é‡ç½®å¯†ç </h2>
            </div>
            <div class="auth-subtitle">è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·ï¼Œæˆ‘ä»¬å°†å‘é€éªŒè¯ç </div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="tel" id="resetPhone" placeholder="æ‰‹æœºå·" maxlength="11" class="modern-input">
                </div>
                <div class="verify-code-wrapper">
                    <input type="text" id="verifyCode" placeholder="è¯·è¾“å…¥éªŒè¯ç " maxlength="6" class="modern-input">
                    <button onclick="sendVerifyCode()" id="sendCodeBtn" class="code-btn">è·å–éªŒè¯ç </button>
                </div>
                <button onclick="verifyCodeAndNext()" class="btn-modern-primary">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>
    </div>

    <!-- å¿˜è®°å¯†ç  - ç¬¬äºŒæ­¥ï¼šè®¾ç½®æ–°å¯†ç  -->
    <div id="forgotPasswordStep2" class="page hidden">
        <div class="auth-container">
            <div class="auth-header">
                <button onclick="backToStep1()" class="back-icon">â†</button>
                <h2>è®¾ç½®æ–°å¯†ç </h2>
            </div>
            <div class="auth-subtitle">è¯·è®¾ç½®æ‚¨çš„æ–°å¯†ç </div>
            <div class="auth-form">
                <div class="input-wrapper">
                    <input type="password" id="newPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—ï¼‰" class="modern-input">
                </div>
                <div class="password-strength-modern" id="resetPasswordStrength">
                    <div class="strength-bar-container">
                        <div id="resetStrengthBar" class="strength-bar"></div>
                    </div>
                    <div class="strength-text" id="resetStrengthText"></div>
                </div>
                <div class="input-wrapper">
                    <input type="password" id="confirmNewPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç " class="modern-input">
                </div>
                <button onclick="resetPassword()" class="btn-modern-primary">å®Œæˆé‡ç½®</button>
            </div>
        </div>
    </div>

    <!-- æˆ‘çš„ä¹¦åº“ä¸»é¡µ -->
    <div id="mainPage" class="page hidden">
        <header class="header">
            <div class="user-info">
                <span id="currentUser">ç”¨æˆ·</span>
                <button onclick="logout()" class="logout-btn">é€€å‡º</button>
            </div>
            <h1>ğŸ“š æˆ‘çš„ä¹¦åº“</h1>
            <div class="selection-info" id="selectionInfo">
                <!-- é€‰æ‹©ä¿¡æ¯æç¤º -->
            </div>
            <div class="search-bar">
                <input type="text" id="searchInput" placeholder="æœç´¢ä¹¦åæˆ–ä½œè€…...">
                <button onclick="performSearch()">æœç´¢</button>
                <button onclick="backToLibrary()" class="btn-secondary">è¿”å›ä¹¦åº“</button>
            </div>
        </header>

        <main class="book-shelf">
            <div class="books-grid" id="booksGrid">
                <!-- ä¹¦ç±å¡ç‰‡ -->
            </div>
            
            <div class="add-book-card" onclick="showAddBookModal()">
                <div class="add-book-icon">+</div>
                <p>æ·»åŠ æ–°ä¹¦</p>
            </div>
        </main>
    </div>

    <!-- è¯­å½•ç®¡ç†é¡µ -->
    <div id="quotesPage" class="page hidden">
        <header class="header">
            <button onclick="backToMain()" class="back-btn">â† è¿”å›</button>
            <h2 id="currentBookTitle">ä¹¦ç±è¯­å½•ç®¡ç†</h2>
        </header>
        
        <div class="quotes-management">
            <!-- æ’­æ”¾æ¨¡å¼æ§åˆ¶é¢æ¿ -->
            <div class="playback-control-panel">
                <div class="playback-header">
                    <span class="playback-title">ğŸµ è¯­å½•æ’­æ”¾è®¾ç½®</span>
                    <span class="playback-hint" id="playbackHint">é€‰æ‹©æ’­æ”¾æ¨¡å¼ï¼Œå¯åŠ¨é¡µå°†æŒ‰æ¨¡å¼æ˜¾ç¤ºè¯­å½•</span>
                </div>
                <div class="playback-modes">
                    <label class="playback-mode-option">
                        <input type="radio" name="playbackMode" value="sequential" onclick="changePlaybackMode('sequential')">
                        <span class="mode-icon">â–¶ï¸</span>
                        <span class="mode-label">é¡ºåºæ’­æ”¾</span>
                        <span class="mode-desc">æŒ‰é¡ºåºæ˜¾ç¤ºé€‰ä¸­çš„è¯­å½•</span>
                    </label>
                    <label class="playback-mode-option">
                        <input type="radio" name="playbackMode" value="random" onclick="changePlaybackMode('random')">
                        <span class="mode-icon">ğŸ”€</span>
                        <span class="mode-label">éšæœºæ’­æ”¾</span>
                        <span class="mode-desc">éšæœºæ˜¾ç¤ºé€‰ä¸­çš„è¯­å½•</span>
                    </label>
                    <label class="playback-mode-option">
                        <input type="radio" name="playbackMode" value="single" onclick="changePlaybackMode('single')">
                        <span class="mode-icon">ğŸ”‚</span>
                        <span class="mode-label">å•æ¡é‡å¤</span>
                        <span class="mode-desc">é‡å¤æ˜¾ç¤ºé€‰ä¸­çš„ä¸€æ¡è¯­å½•</span>
                    </label>
                </div>
                <div class="selection-summary" id="selectionSummary">
                    <!-- é€‰æ‹©ç»Ÿè®¡ä¿¡æ¯ -->
                </div>
            </div>
            
            <div class="quotes-list" id="quotesList">
                <!-- è¯­å½•åˆ—è¡¨ -->
            </div>
            <button onclick="showAddQuoteModal()" class="add-quote-btn">+ æ·»åŠ è¯­å½•</button>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <!-- æ·»åŠ æ–°ä¹¦æ¨¡æ€æ¡† -->
    <div id="addBookModal" class="modal hidden">
        <div class="modal-content">
            <h3>æ·»åŠ æ–°ä¹¦</h3>
            <input type="text" id="newBookName" placeholder="ä¹¦ç±åç§°">
            <input type="text" id="newBookAuthor" placeholder="ä½œè€…">
            <div class="modal-actions">
                <button onclick="addNewBook()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeAddBookModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <div id="editBookModal" class="modal hidden">
        <div class="modal-content">
            <h3>ç¼–è¾‘ä¹¦ç±ä¿¡æ¯</h3>
            <input type="hidden" id="editBookIndex">
            <input type="text" id="editBookName" placeholder="ä¹¦ç±åç§°">
            <input type="text" id="editBookAuthor" placeholder="ä½œè€…">
            <div class="modal-actions">
                <button onclick="saveBookEdit()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeEditBookModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div id="addQuoteModal" class="modal hidden">
        <div class="modal-content">
            <h3>æ·»åŠ è¯­å½•</h3>
            <textarea id="newQuoteText" placeholder="è¾“å…¥è¯­å½•å†…å®¹..."></textarea>
            <div class="quote-metadata">
                <input type="text" id="newQuotePage" placeholder="é¡µç ï¼ˆå¯é€‰ï¼‰">
                <input type="text" id="newQuoteTag" placeholder="æ ‡ç­¾ï¼ˆå¯é€‰ï¼Œç”¨é€—å·åˆ†éš”ï¼‰">
            </div>
            <div class="modal-actions">
                <button onclick="addNewQuote()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeAddQuoteModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <div id="editQuoteModal" class="modal hidden">
        <div class="modal-content">
            <h3>ç¼–è¾‘è¯­å½•</h3>
            <input type="hidden" id="editQuoteIndex">
            <textarea id="editQuoteText" placeholder="è¾“å…¥è¯­å½•å†…å®¹..."></textarea>
            <div class="quote-metadata">
                <input type="text" id="editQuotePage" placeholder="é¡µç ï¼ˆå¯é€‰ï¼‰">
                <input type="text" id="editQuoteTag" placeholder="æ ‡ç­¾ï¼ˆå¯é€‰ï¼Œç”¨é€—å·åˆ†éš”ï¼‰">
            </div>
            <div class="modal-actions">
                <button onclick="saveQuoteEdit()" class="btn-primary">ä¿å­˜</button>
                <button onclick="closeEditQuoteModal()" class="btn-secondary">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- åº”ç”¨è„šæœ¬ -->
    <script src="leancloud-config.js"></script>
    <script src="playback-controller.js"></script>
    <script src="script.js"></script>
    <script src="script-leancloud.js"></script>
    
    <!-- é”™è¯¯å¤„ç† -->
    <script>
        // æ£€æŸ¥ LeanCloud æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ
        window.addEventListener('load', function() {
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿åˆå§‹åŒ–å®Œæˆ
            setTimeout(function() {
                if (typeof LEANCLOUD_CONFIG === 'undefined') {
                    console.warn('LeanCloud åˆå§‹åŒ–å¤±è´¥ï¼Œå¯èƒ½å½±å“éƒ¨åˆ†åŠŸèƒ½');
                    // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤º
                    const currentUserElement = document.getElementById('currentUser');
                    if (currentUserElement) {
                        currentUserElement.textContent = 'ç¦»çº¿æ¨¡å¼';
                    }
                }
            }, 1000);
        });
    </script>
</body>
</html>