# 播放模式切换测试

## 🎯 测试目标

验证从单条重复模式切换到其他模式时，复选框能够正常启用。

## 📋 测试步骤

### 测试1：单条重复 → 随机播放

1. **进入语录管理页**
   - 登录应用
   - 进入某本书的语录管理页

2. **设置单条重复模式**
   - 勾选第3条语录（任意一条）
   - 选择"单条重复"播放模式
   - 观察：其他语录的复选框应该被禁用（灰色）

3. **切换到随机播放**
   - 点击"随机播放"单选按钮
   - 观察：**所有复选框都应该重新启用**
   - 尝试勾选其他语录（如第5、7条）
   - 验证：应该可以正常勾选

4. **验证控制台日志**
   ```
   === 切换播放模式 ===
   旧模式: single 新模式: random
   已重新渲染语录列表，复选框状态已更新
   播放模式已切换: single → random
   ```

### 测试2：单条重复 → 顺序播放

1. **重新设置单条重复**
   - 取消之前的选择
   - 勾选第2条语录
   - 选择"单条重复"
   - 验证：其他复选框被禁用

2. **切换到顺序播放**
   - 点击"顺序播放"单选按钮
   - 观察：**所有复选框都应该重新启用**
   - 尝试勾选多条语录（如第2、4、6条）
   - 验证：应该可以正常勾选多条

3. **验证控制台日志**
   ```
   === 切换播放模式 ===
   旧模式: single 新模式: sequential
   ✅ 切换到顺序播放模式，播放索引已重置为0
   已重新渲染语录列表，复选框状态已更新
   播放模式已切换: single → sequential
   ```

### 测试3：随机播放 → 单条重复 → 随机播放

1. **选择多条语录**
   - 勾选第1、3、5条语录
   - 选择"随机播放"

2. **切换到单条重复**
   - 点击"单条重复"
   - 观察：只保留第1条语录被选中
   - 验证：第3、5条复选框被禁用

3. **再切换回随机播放**
   - 点击"随机播放"
   - 观察：**所有复选框重新启用**
   - 验证：可以重新勾选第3、5条

## ✅ 预期结果

### 从单条重复切换到其他模式时：

| 操作 | 预期结果 |
|------|---------|
| 切换到随机播放 | ✅ 所有复选框启用，可以勾选多条 |
| 切换到顺序播放 | ✅ 所有复选框启用，可以勾选多条 |
| 保持单条重复 | ✅ 只有选中的语录可用，其他禁用 |

### 从其他模式切换到单条重复时：

| 操作 | 预期结果 |
|------|---------|
| 有多条选中 | ✅ 只保留第一条，其他复选框禁用 |
| 有一条选中 | ✅ 保持当前选中，其他复选框禁用 |
| 没有选中 | ✅ 可以勾选任意一条，勾选后其他禁用 |

## 🐛 问题排查

### 如果复选框仍然被禁用：

1. **刷新页面**
   - 有时需要完全刷新页面
   - 重新进入语录管理页

2. **检查控制台**
   - 查看是否有错误信息
   - 确认是否显示"已重新渲染语录列表"

3. **清空浏览器缓存**
   - 按 Ctrl+Shift+Delete
   - 清空缓存和Cookie
   - 重新登录

## 💡 技术说明

### 修改内容

修改了 [`changePlaybackMode`](playback-controller.js) 函数：

```javascript
// 之前：只在切换到单条重复时渲染
if (newMode === 'single') {
    renderQuotesList();
}

// 现在：无论切换到什么模式都重新渲染
if (typeof renderQuotesList === 'function') {
    renderQuotesList();
    console.log('已重新渲染语录列表，复选框状态已更新');
}
```

### 工作原理

1. **切换模式时**
   - 保存新的播放模式
   - 调用 `renderQuotesList()` 重新渲染

2. **渲染语录列表时**
   - 检查当前播放模式
   - 如果是单条重复 + 有选中：禁用其他复选框
   - 如果是其他模式：启用所有复选框

3. **复选框状态判断**
   ```javascript
   const isSingleMode = settings.mode === 'single';
   const hasSelected = settings.selectedQuotes.some(...);
   const disabled = isSingleMode && hasSelected && !isSelected;
   ```

## 📝 测试记录

| 测试项 | 日期 | 结果 | 备注 |
|--------|------|------|------|
| 单条→随机 | | ⬜ | |
| 单条→顺序 | | ⬜ | |
| 随机→单条→随机 | | ⬜ | |

**测试通过标准：**
- ✅ 复选框状态正确切换
- ✅ 控制台无错误
- ✅ 可以正常勾选/取消勾选
