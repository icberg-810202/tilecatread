# 顺序播放功能测试步骤

## 📋 测试准备

1. **启动服务器**
   - 右键 `start-server.ps1` → 使用 PowerShell 运行
   - 或在终端执行：`powershell -File start-server.ps1`

2. **打开浏览器**
   - 访问：`http://localhost:8080/index.html`

## 🧪 测试步骤

### 步骤1：登录并选择语录

1. 登录应用（如果尚未登录）
2. 进入某本书的语录管理页
3. **选择至少3-5条语录**（勾选复选框）
4. 确认选中的语录已高亮显示

### 步骤2：设置为顺序播放

1. 在播放模式选择区域，点击 **"顺序播放"** 单选按钮
2. **打开浏览器控制台**（按 F12）
3. 查看控制台输出，应该看到类似：
   ```
   === 切换播放模式 ===
   旧模式: random 新模式: sequential
   切换前的索引: 2
   ✅ 切换到顺序播放模式，播放索引已重置为0
   准备保存的设置: {"mode":"sequential","selectedQuotes":[...],"currentIndex":0}
   ✅ 保存后验证 - 模式: sequential 索引: 0
   ```
4. **重要**：确认看到 `索引: 0`

### 步骤3：第一次测试

1. **完全关闭浏览器标签页**（不是最小化）
2. **重新打开** `http://localhost:8080/index.html`
3. 应该看到启动页，显示**第1条**选中的语录
4. 在控制台查看日志：
   ```
   === 顺序播放模式 ===
   原始 currentIndex 值: 0
   准备显示第1条语录: {...}
   ✅ 顺序播放：显示第1条，下次将显示第2条
   已保存的 nextIndex: 1
   ```

### 步骤4：第二次测试

1. **再次关闭标签页**
2. **再次打开** `http://localhost:8080/index.html`
3. 应该看到**第2条**选中的语录
4. 控制台应显示：
   ```
   原始 currentIndex 值: 1
   准备显示第2条语录: {...}
   ✅ 顺序播放：显示第2条，下次将显示第3条
   ```

### 步骤5：继续测试

1. 重复关闭/打开标签页
2. 观察语录是否按顺序显示：第3条 → 第4条 → 第5条 → 第1条（循环）

## ✅ 预期结果

- ✅ 从随机播放切换到顺序播放时，索引重置为0
- ✅ 每次打开启动页时，显示的语录按顺序递增
- ✅ 到达最后一条后，循环回到第一条
- ✅ 控制台日志清晰显示当前索引和下次索引

## ❌ 如果出现问题

### 问题1：语录顺序混乱

**检查点**：
1. 打开 `http://localhost:8080/debug-playback.html`
2. 查看"当前索引"是否正确递增
3. 点击"🔄 刷新设置"查看实时数据

### 问题2：切换模式后索引不是0

**解决方案**：
1. 打开调试工具页面
2. 点击"↺ 重置索引为0"
3. 重新测试

### 问题3：控制台没有日志输出

**检查**：
- 确保按 F12 打开了开发者工具
- 切换到 "Console" 标签
- 刷新页面重新查看

## 📝 控制台关键日志说明

| 日志内容 | 含义 |
|---------|------|
| `原始 currentIndex 值: X` | 从 localStorage 读取的索引值 |
| `准备显示第X条语录` | 即将显示的语录序号 |
| `下次将显示第X条` | 保存到 localStorage 的下一个索引 |
| `⚠️ 索引无效，重置为0` | 检测到索引异常，自动修复 |

## 🔧 调试工具

- **主调试工具**：`http://localhost:8080/debug-playback.html`
  - 查看播放设置
  - 手动重置索引
  - 清空设置

- **顺序播放测试工具**：`http://localhost:8080/test-sequential.html`
  - 模拟播放
  - 查看详细日志
  - 验证索引递增

## 💡 提示

1. **测试前清空浏览器缓存**可以避免旧数据干扰
2. **每次切换模式后等待1秒**再关闭标签页，确保数据已保存
3. **使用隐私模式**可以快速测试"首次访问"场景
